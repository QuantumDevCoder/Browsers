name: Mega Docker CI + PR

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  docker-build-and-pr:
    name: Docker Build, Push & PR
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]

    steps:
      # 1. Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Set up Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Create branch and push
        if: false
        run: |
          git config user.name "github"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          BRANCH="auto-pr-${{ github.sha }}-${{ matrix.os }}"
          git checkout -b $BRANCH
          echo "Docker image info for ${{ matrix.os }}: my-app-${{ matrix.os }}:${{ github.sha }}" > docker-info-${{ matrix.os }}.txt
          git add docker-info-${{ matrix.os }}.txt
          git commit -m "Add Docker info for ${{ matrix.os }}"
          git push https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/QuantumDevCoder/Browsers.git $BRANCH

      - name: Create Pull Request
        if: false
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "Add Docker info for $IMAGE_TAG"
          branch: auto-pr-${{ github.sha }}-${{ matrix.os }}
          title: "Automated PR: Docker update $IMAGE_TAG"
          body: |
            This PR was created automatically by GitHub Actions.
            Docker image $IMAGE_TAG has been built, SHA computed, and pushed.
